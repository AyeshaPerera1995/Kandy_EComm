<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Kandy Pharmacy | <%=sub_title%>
    </title>
    <meta name="robots" content="noindex, follow" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Place favicon.png in the root directory -->
    <link rel="shortcut icon" href="/img/favicon.png" type="image/x-icon" />
    <!-- Font Icons css -->
    <link rel="stylesheet" href="/css/font-icons.css">
    <!-- plugins css -->
    <link rel="stylesheet" href="/css/plugins.css">
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- Responsive css -->
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

    <!-- Toastr  -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.1/css/toastr.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
<!-- <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta/css/bootstrap.min.css'> -->
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
<script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.4/vue.js'></script>

</head>

<style>

body {
  font-family: 'Roboto';
}

.step-wrapper {
  padding: 20px 0;
  display: none;
}
.step-wrapper.active {
  display: block;
}

.step-indicator {
  border-collapse: separate;
  display: table;
  margin-left: 0px;
  position: relative;
  table-layout: fixed;
  text-align: center;
  vertical-align: middle;
  padding-left: 0;
  padding-top: 20px;
}
.step-indicator li {
  display: table-cell;
  position: relative;
  float: none;
  padding: 0;
  width: 1%;
}
.step-indicator li:after {
  background-color: #ccc;
  content: "";
  display: block;
  height: 1px;
  position: absolute;
  width: 100%;
  top: 32px;
}
.step-indicator li:after {
  left: 50%;
}
.step-indicator li:last-child:after {
  display: none;
}
.step-indicator li.active .step {
  border-color: #0ca57c;
  color: #0ca57c;
}
.step-indicator li.active .caption {
  color: #0ca57c;
}
.step-indicator li.complete:after {
  background-color: #87D37C;
}
.step-indicator li.complete .step {
  border-color: #87D37C;
  color: #87D37C;
}
.step-indicator li.complete .caption {
  color: #87D37C;
}
.step-indicator .step {
  background-color: #fff;
  border-radius: 50%;
  border: 1px solid #ccc;
  color: #ccc;
  font-size: 24px;
  height: 64px;
  line-height: 64px;
  margin: 0 auto;
  position: relative;
  width: 64px;
  z-index: 1;
}
.step-indicator .step:hover {
  cursor: pointer;
}
.step-indicator .caption {
  color: #ccc;
  padding-top: 5px;
}

input[type="text"],
    input[type="email"],
    input[type="password"] {
        height: 45px;
        border-radius: 10px;
        font-family: 'Roboto';
    }
</style>

<body>

    <!-- Body main wrapper start -->
    <div class="body-wrapper">

        <%- include('includes/header.ejs'); %>

            <div class="ltn__utilize-overlay"></div>

            <hr style="height: 5px; color:#084434; margin: 20px;">

            <!-- LOGIN AREA START (Register) -->
            <div class="ltn__login-area pb-50">
                <div class="container">
                    <div class="row">

                       <!-- This script got from frontendfreecode.com -->
<form method="POST" action="">
  <div class="container">
      <div id="app">
          <step-navigation :steps="steps" :currentstep="currentstep">
          </step-navigation>
          <br>
          <div v-show="currentstep == 1">
              <h1>Enter Your Mobile Number</h1>
              <div class="form-group">
                  <label style="margin-bottom: 10px;">Enter your mobile number in the field below.</label>
                  <input type="text" name="mobile" id="mobile" required class="form-control" placeholder="07x xxx xxxx">
              </div>
          </div>
  
          <div v-show="currentstep == 2">
            <h1>Two Step Verification</h1>
            <div class="form-group">
                <label style="margin-bottom: 10px;">Type your 4 digit security code.</label>
                <div class="auth-input-wrapper d-flex align-items-center">
                  <input type="text" class="form-control" id="one"  maxlength="1" style="width: 100px; padding-left: 45px; margin-right: 40px; margin-bottom: 5px;" oninput="moveToNextField(event)">
                  <input type="text" class="form-control" id="two"  maxlength="1" style="width: 100px; padding-left: 45px; margin-right: 40px; margin-bottom: 5px;" oninput="moveToNextField(event)">
                  <input type="text" class="form-control" id="three"  maxlength="1" style="width: 100px; padding-left: 45px; margin-right: 40px; margin-bottom: 5px;" oninput="moveToNextField(event)">
                  <input type="text" class="form-control" id="four"  maxlength="1" style="width: 100px; padding-left: 45px; margin-right: 40px; margin-bottom: 5px;" oninput="moveToNextField(event)">
                </div>  
                <small id="fileHelp" class="form-text text-muted"><span>Didnâ€™t get the code?</span><a style="color: #10943e; cursor: pointer;" id="resend_link"><span>&nbsp;Resend Code</span></a></small> 
            </div>
          </div>
  
          <div v-show="currentstep == 3">
            <h1>Account Information</h1>
            <div class="form-group">
                <label style="margin-bottom: 10px;">Enter your account details.</label>
             
                <input type="text" name="firstname" id="firstname" placeholder="First Name*">
                <input type="text" name="lastname" id="lastname" placeholder="Last Name*">
                <input type="text" name="email" placeholder="Email*">
                <input type="password" name="password" id="password" placeholder="Password*">
                <input type="password" name="confirmpassword" id="confirmpassword" placeholder="Confirm Password*">
               
            </div>
          </div>
  
          <step v-for="step in steps" :currentstep="currentstep" :key="step.id" :step="step" :stepcount="steps.length" @step-change="stepChanged">
          </step>
  
          <script type="x-template" id="step-navigation-template">
              <ol class="step-indicator">
                  <li v-for="step in steps" is="step-navigation-step" :key="step.id" :step="step" :currentstep="currentstep">
                  </li>
              </ol>
          </script>
  
          <script type="x-template" id="step-navigation-step-template">
              <li :class="indicatorclass">
                  <div class="step"><i :class="step.icon_class"></i></div>
                  <div class="caption hidden-xs hidden-sm">
                    <span v-text="step.title" style="font-weight: bold;"></span><br>
                    <span v-text="step.sub_title" style="font-size: 13px; color: #b9b4b4;"></span>
                  </div>
              </li>
          </script>
  
          <script type="x-template" id="step-template">
              <div class="step-wrapper" :class="stepWrapperClass">
                  <button type="button" class="btn btn-success" @click="lastStep" :disabled="firststep">
                      Back
                  </button>
                  <button type="button" class="btn btn-success" @click="nextStep" :disabled="laststep">
                      Next
                  </button>                
                  <button type="submit" class="btn btn-success" v-if="laststep">
                      Submit
                  </button>
              </div>
          </script>
      </div>
  </div>
  </form>
  <div class="row">
    <a style="font-size: 11pt; text-decoration: none; width: 300px; margin-left: 930px;" href="/auth/login/1">Already have an account? Sign in</a>
  </div>                                                                          

                    </div>
                </div>
            </div>
            <!-- LOGIN AREA END -->

            <%- include('includes/footer.ejs'); %>

    </div>
    <!-- Body main wrapper end -->

    <!-- All JS Plugins -->
    <script src="/js/plugins.js"></script>
    <!-- Main JS -->
    <script src="/js/main.js"></script>

    <!-- jQuery -->
    <script src="/vendors/jquery/dist/jquery.min.js"></script>
    <!-- Toastr  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.1/js/toastr.js"></script>

    <script>
        $(document).ready(function () {
            const urlParams = new URLSearchParams(window.location.search);
            const error_msg = urlParams.get('error_msg');
            const success_msg = urlParams.get('success_msg');

            if (error_msg === 'Passwords are not matched!') {
                toastr.error(
                    error_msg,
                    'Error',
                    {
                        timeOut: 2000,
                        fadeOut: 2000,
                        onHidden: function () {
                            window.location.href = window.location.pathname;
                        }
                    }
                );
            }

            if (success_msg.length > 0) {
                toastr.success(
                    success_msg,
                    'Success',
                    {
                        timeOut: 2000,
                        fadeOut: 1000,
                        onHidden: function () {
                            window.location.href = window.location.pathname;
                        }
                    }
                );
            }            
        });

    function moveToNextField(event) {
      const input = event.target;
      const maxLength = parseInt(input.getAttribute('maxlength'));

      if (input.value.length === maxLength) {
        const nextInput = input.nextElementSibling;
        if (nextInput !== null) {
          nextInput.focus();
        }
      }
    }


  Vue.component("step-navigation-step", {
  template: "#step-navigation-step-template",

  props: ["step", "currentstep"],

  computed: {
    indicatorclass() {
      return {
        active: this.step.id == this.currentstep,
        complete: this.currentstep > this.step.id };

    } } });



Vue.component("step-navigation", {
  template: "#step-navigation-template",

  props: ["steps", "currentstep"] });


Vue.component("step", {
  template: "#step-template",

  props: ["step", "stepcount", "currentstep"],

  computed: {
    active() {
      return this.step.id == this.currentstep;
    },

    firststep() {
      return this.currentstep == 1;
    },

    laststep() {
      //console.log(this.currentstep+' - '+this.stepcount)
      return this.currentstep == this.stepcount;
    },

    stepWrapperClass() {
      return {
        active: this.active };

    } },


  methods: {
    nextStep() {
      var self = this;
      const mobile = $("#mobile").val()
      const one = $("#one").val(); const two = $("#two").val(); const three = $("#three").val(); const four = $("#four").val(); 
      const code = one+two+three+four
      // //console.log(name);
      // //console.log(code);
      // //console.log(self.currentstep)
      if(mobile == ""){
        toastr.error("Please enter your mobile number.",'ERROR', {timeOut: 2000,fadeOut: 2000,});
      }else if(mobile != "" & self.currentstep == 1){
        // Send verification code to mobile 
        $.ajax({
                url: 'http://app360dev-001-site5.dtempurl.com/api/ECommerce/MobileVarificationMaster/'+mobile,
                type: 'GET',
                success: function (res) {
                  //console.log(res)
                  if(res.status == 'Success' && res.message == 'User Already Exists'){
                    // This user Has an account in POS, and sent OTP for login.
                    toastr.info(
                      "You already have an account in the System. Please use OTP verification for Login.", 'Account Already Exists.', 
                      { closeButton: true, progressBar: true, showMethod: 'slideDown', timeOut: 4000,
                        onHidden: function () {
                          window.location.href = '/auth/login/'+mobile;
                        }
                      }
                    );
                  }
                  else if(res.status == 'Fail' && res.message == 'User Already Exists'){
                    // This user Has an account in Ecom and need to send the OTP using filter 0, /api/ECommerce/Customer/Login
                    $.ajax({
                      url: 'http://app360dev-001-site5.dtempurl.com/api/ECommerce/Customer/Login?filter=0',
                      type: 'POST',
                      data: JSON.stringify({
                        "userName": "string",
                        "password": "string",
                        "employeeBarcode": "string",
                        "phone": mobile,
                        "otpCode": "string",
                        "cartItems": []
                      }),
                      contentType: "application/json",
                      success: function (res) {
                        if(res.status == 'Success'){
                          toastr.info(
                             "You already have an account in Kandy Pharmacy. Please use OTP verification for Login.", 'Account Already Exists.', { timeOut: 2000, fadeOut: 2000,
                              onHidden: function () {
                                window.location.href = '/auth/login/'+mobile;
                              }
                          } 
                        );
                        }else{
                          //console.log("error")
                        }
                      }
                    })
                    
                  }
                  else if(res.status == 'Success' && res.message == 'Successful'){
                   // New user registration and proceed with normal process
                    //console.log("New Account creation")
                    self.$emit("step-change", self.currentstep + 1);
                  }
                 
                }
        })
      }
      else if(one == "" || two == "" || three == "" || four == ""){
        toastr.error("Please enter verification code here.",'ERROR', {timeOut: 2000,fadeOut: 2000,});
      }
      else if(code != "" & self.currentstep == 2){
        // Verify the mobile 
        $.ajax({
                url: 'http://app360dev-001-site5.dtempurl.com/api/ECommerce/MobileVarificationMaster/Verify/'+mobile+'/'+code,
                type: 'GET',
                success: function (res) {
                  if(res.status == 'Success'){
                    //console.log(res.content)
                    self.$emit("step-change", self.currentstep + 1);
                  }else{
                    toastr.error("Mobile number is not verified.",'ERROR', {timeOut: 2000,fadeOut: 2000,});
                  }                
                }
        })
      }
      
    },
    lastStep() {
      // alert('click 2') 
      // const fname = $("#firstname").val()
      // const lname = $("#lastname").val()
      // const email = $("#email").val()
      // const pass = $("#password").val()
      // const cpass = $("#confirmpassword").val()
      // if(fname == "" || lname == "" || email == "" || pass == "" || cpass == ""){
      //   toastr.error("Please fill required fields.",'ERROR', {timeOut: 2000,fadeOut: 2000,});
      // }else if(pass != cpass){
      //   toastr.error("Passwords are not matched!",'ERROR', {timeOut: 2000,fadeOut: 2000,});
      // }else {
      // this.$emit("step-change", this.currentstep - 1);
      // }
      //console.log('line 393: '+this.currentstep - 1)
      this.$emit("step-change", this.currentstep - 1);
    } 
  } 
  });



new Vue({
  el: "#app",

  data: {
    currentstep: 1,

    steps: [
    {
      id: 1,
      title: "Contact Info",
      sub_title: "Enter Your Number",
      icon_class: "fa fa-phone" },

    {
      id: 2,
      title: "Verification",
      sub_title: "Verify Your Number",
      icon_class: "fa fa-check-square-o" },

    {
      id: 3,
      title: "Create Account",
      sub_title: "Get Customer Information",
      icon_class: "fa fa-address-card" }] 
  },

  methods: {
    stepChanged(step) {
      this.currentstep = step;
    } } 
  });

    </script>

</body>

</html>